<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Aloha</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Generic machine learning, lazy features" /><meta name="author" content="eHarmony" /><meta name="og:image" content="/aloha/img/poster.png" /><meta name="og:title" content="Aloha" /><meta name="og:site_name" content="Aloha" /><meta name="og:url" content="http://eharmony.github.io/aloha" /><meta name="og:type" content="website" /><meta name="og:description" content="Generic machine learning, lazy features" /><meta name="twitter:image" content="/aloha/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><meta name="kazari-dependencies" content="" /><meta name="kazari-resolvers" content="" /><link rel="icon" type="image/png" href="/aloha/img/favicon.png" /><link rel="icon" type="image/png" sizes="16x16" href="/aloha/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/aloha/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/aloha/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/aloha/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/aloha/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/aloha/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/aloha/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/aloha/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/aloha/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/aloha/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/aloha/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/aloha/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/aloha/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/aloha/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/aloha/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/aloha/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/aloha/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/aloha/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/aloha/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/aloha/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/aloha/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/aloha/css/style.css" /><link rel="stylesheet" href="/aloha/css/palette.css" /><link rel="stylesheet" href="/aloha/css/codemirror.css" /><link rel="stylesheet" href="/aloha/css/kazari-style.css" /><link rel="stylesheet" href="/aloha/css/solarized-dark.css" /><link rel="stylesheet" href="/aloha/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/aloha/" class="brand"><div class="brand-wrapper"><span>Aloha</span></div></a></li> <li><a href="/aloha/docs/api/index.html" class="">API Docs</a></li> <li><a href="/aloha/docs/getting_started.html" class="">Getting Started (Data Sci)</a></li> <li><a href="/aloha/docs/getting_started_eng.html" class="">Getting Started (Data Eng)</a></li> <li><a href="/aloha/docs/dataset.html" class="">Constructing Datasets</a></li> <li><a href="/aloha/docs/in_depth_walkthrough.html" class="">In Depth Walkthrough</a></li> <li><a href="/aloha/docs/model_formats.html" class="">Model Formats</a></li> <li><a href="/aloha/docs/release_notes.html" class="">Release Notes</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eharmony/aloha"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eharmony/aloha"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Aloha Generic machine learning, lazy features');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Aloha Generic machine learning, lazy features');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="eharmony" data-github-repo="aloha"><div class="content-wrapper"><section><h1 id="getting-started-data-engineers">Getting Started (Data Engineers)</h1>

<p>This is for data engineers that might be tasked with integrating Aloha into a scoring or prediction process
such as a prediction web service, etc.</p>

<p>For the purpose of constructing prediction pipelines, there are four main components:</p>

<ul>
  <li><strong>Semantics</strong> give meaning to features that appear in models.</li>
  <li><strong>Auditors</strong> translate raw model predictions to an output type easily consumable by the model caller.</li>
  <li><strong>Factories</strong> produce models.  Factories are parametrized by <em>semantics</em> and an <em>auditor</em>.</li>
  <li><strong>Models</strong> make predictions.</li>
</ul>

<h2 id="semantics">Semantics</h2>

<p>Models can be created directly in Aloha but the preferred way to create a model is to specify model definitions
in JSON and use model factories to interpret the JSON to produce a model.  A
<a href="https://en.wikipedia.org/wiki/Body_mass_index#History_and_usage_in_obesity_studies">BMI</a> feature in the JSON model
definition might look like the following:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"703 * ${weight} / pow(${height}, 2)"</span><span class="w">
</span></code></pre>
</div>

<h3 id="compiledsemantics">CompiledSemantics</h3>

<p>To interpret this feature, a <code class="highlighter-rouge">Semantics</code> instance is needed.  In Aloha, semantics implementations are parametrized
on the model input type, typically indicated by the type parameter <code class="highlighter-rouge">A</code> in the Aloha code.  The most common—and
presumably the most powerful—type of semantics is the <code class="highlighter-rouge">CompiledSemantics</code>, which performs code generation and
on-the-fly compilation at model creation time.  The compiled semantics is responsible parsing and emitting code
for the entire feature definition (like the one for BMI above).</p>

<p>Notice in the feature above that there are two <em>variables</em> on which the BMI calculation is based:
<strong>height</strong> and <strong>weight</strong>.  The compiled semantics in Aloha is modularized so that most of the machinery can
be reused but the interpretation of variables in a feature varies by domain.  Therefore, there are
<code class="highlighter-rouge">CompiledSemanticsPlugin</code>s for various input classes including CSV data, Protocol Buffer data, Avro data, etc.</p>

<blockquote>
  <p><strong>Note</strong>: <em>It is a rather heavyweight process to compile the features into functions.  It is time and memory
intensive.  Once the models are all created by the model factory, it is recommended to not hold a reference to
a model factory.  This disclaimer is noted here because it is the CompiledSemantics that embeds the Scala
compiler so it is the most expensive component.</em></p>
</blockquote>

<h4 id="creating-compiledsemanticsplugin-for-avro">Creating CompiledSemanticsPlugin for Avro</h4>

<p>Compiling Avro definitions to Java classes via Avro’s <code class="highlighter-rouge">avro-tools</code> generates classes that implement both
<a href="https://avro.apache.org/docs/current/api/java/org/apache/avro/specific/SpecificRecord.html">SpecificRecord</a> and
<a href="https://avro.apache.org/docs/current/api/java/org/apache/avro/generic/GenericRecord.html">GenericRecord</a>.  Aloha’s
<code class="highlighter-rouge">CompiledSemanticsAvroPlugin</code> is based on <code class="highlighter-rouge">GenericRecord</code>.  While <code class="highlighter-rouge">GenericRecord</code>’s interface is untyped, Aloha uses
a provided Avro <code class="highlighter-rouge">Schema</code> to provide a typed interface.  So as long as the data adheres to the schema, Aloha will have
type information it can use to ensure features are well-typed.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.avro.Schema</span>
<span class="k">import</span> <span class="nn">org.apache.avro.generic.GenericRecord</span>
<span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.plugin.avro.CompiledSemanticsAvroPlugin</span>

<span class="c1">// Get an Avro Schema from somewhere.
</span><span class="k">val</span> <span class="n">schema</span><span class="k">:</span> <span class="kt">Schema</span> <span class="o">=</span> <span class="n">getSchema</span><span class="o">()</span>

<span class="c1">// Here we use the GenericRecord but a more specific class can be used if desired.
</span><span class="k">val</span> <span class="n">plugin</span> <span class="k">=</span> <span class="nc">CompiledSemanticsAvroPlugin</span><span class="o">[</span><span class="kt">GenericRecord</span><span class="o">](</span><span class="n">schema</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="creating-compiledsemanticsplugin-for-protocol-buffers">Creating CompiledSemanticsPlugin for Protocol Buffers</h4>

<p>Compiling Protocol Buffers via <code class="highlighter-rouge">protoc</code> (2.4.1) yields Java classes that extend <code class="highlighter-rouge">GeneratedMessage</code>.
Aloha accepts types extending <code class="highlighter-rouge">GeneratedMessage</code> and can extract the type information without needing an
external schema.  This can be accomplished via:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.plugin.proto.CompiledSemanticsProtoPlugin</span>
<span class="k">import</span> <span class="nn">com.eharmony.aloha.test.proto.TestProtoBuffs.TestProto</span> <span class="c1">// Some protobuf class
</span>
<span class="k">val</span> <span class="n">plugin</span> <span class="k">=</span> <span class="nc">CompiledSemanticsProtoPlugin</span><span class="o">[</span><span class="kt">TestProto</span><span class="o">]</span>
</code></pre>
</div>

<h4 id="creating-compiledsemanticsplugin-for-csv-data">Creating CompiledSemanticsPlugin for CSV Data</h4>

<p>To define a compiled semantics plugin for CSV Data, we need to specify a field name to type mapping.  Field order
isn’t defined here as it’s unnecessary at this point.  That defined by the data itself.  For more information, see
the <a href="/aloha/docs/in_depth_walkthrough.html">In-Depth Walkthrough</a>.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.plugin.csv.CompiledSemanticsCsvPlugin</span>
<span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.plugin.csv.CsvTypes.</span><span class="o">{</span><span class="nc">IntType</span><span class="o">,</span> <span class="nc">FloatOptionType</span><span class="o">}</span>

<span class="k">val</span> <span class="n">plugin</span> <span class="k">=</span> <span class="nc">CompiledSemanticsCsvPlugin</span><span class="o">(</span>
  <span class="s">"height"</span> <span class="o">-&gt;</span> <span class="nc">IntType</span><span class="o">,</span>          <span class="c1">// Required integer field
</span>  <span class="s">"weight"</span> <span class="o">-&gt;</span> <span class="nc">FloatOptionType</span>   <span class="c1">// Optional float field
</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="creating-compiledsemantics-from-a-compiledsemanticsplugin">Creating CompiledSemantics from a CompiledSemanticsPlugin</h4>

<p>Once a compiled semantics plugin is created, we need to pass it to <code class="highlighter-rouge">CompiledSemantics</code>.  This is rather easy.  There
are a few additional things needed to do so:</p>

<ul>
  <li><em>a class cache directory</em> (optional, but suggested)</li>
  <li><em>a compiler instance</em></li>
  <li><em>imports to be injected into features</em>: These will typically be determined by data scientists.</li>
</ul>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.CompiledSemantics</span>
<span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.compiler.TwitterEvalCompiler</span>

<span class="c1">// If provided, needs to be an existing directory.
</span><span class="k">val</span> <span class="n">cacheDir</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">java.io.File</span><span class="o">]</span> <span class="k">=</span> <span class="n">getCacheDir</span><span class="o">()</span>

<span class="k">val</span> <span class="n">compiler</span> <span class="k">=</span> <span class="nc">TwitterEvalCompiler</span><span class="o">(</span><span class="n">classCacheDir</span> <span class="k">=</span> <span class="n">cacheDir</span><span class="o">)</span>

<span class="c1">// BasicFunctions is not necessary but it's like Aloha's Predef.
// It is advisable to import this.  Additional import statements
// can be included to provide additional functionality, UDFs, etc.
</span><span class="k">val</span> <span class="n">imports</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="s">"com.eharmony.aloha.feature.BasicFunctions._"</span>
<span class="o">)</span>

<span class="c1">// An implicit execution context is needs by the semantics.
</span><span class="k">import</span> <span class="nn">concurrent.ExecutionContext.Implicits.global</span>
<span class="k">val</span> <span class="n">semantics</span> <span class="k">=</span> <span class="nc">CompiledSemantics</span><span class="o">(</span><span class="n">compiler</span><span class="o">,</span> <span class="n">plugin</span><span class="o">,</span> <span class="n">imports</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="auditor">Auditor</h2>

<p>Models are designed to return predictions in a data structure easy for the calling environment to consume.
Internally, models may produce predictions in some primitive format like 32-bit floats, but when the predictions
are returned by the model, they are boxed into some kind of container.  This is because models may have failures,
in which case a prediction may be impossible.  To differentiate between valid predictions and failures, Aloha
<strong>DOES NOT</strong> use sentinel or default values for primitive types.</p>

<p>Auditors are the component responsible for boxing scores into some kind of container.  Since models in Aloha can be
nested to form hierarchical models, the auditors need to handle this recursive structure.  Therefore, auditors are
deal with trees of data including the prediction itself as well as additional information about missing features,
errors messages and other diagnostic information.</p>

<p>The three main auditors are</p>

<ul>
  <li><a href="/aloha/docs/api/index.html#com.eharmony.aloha.audit.impl.OptionAuditor">OptionAuditor</a></li>
  <li><a href="/aloha/docs/api/index.html#com.eharmony.aloha.audit.impl.proto.ScoreAuditor">proto.ScoreAuditor</a></li>
  <li><a href="/aloha/docs/api/index.html#com.eharmony.aloha.audit.impl.avro.AvroScoreAuditor">AvroScoreAuditor</a></li>
</ul>

<p>Many more are possible, for instance, there’s a <code class="highlighter-rouge">TreeAuditor</code> in <code class="highlighter-rouge">aloha-core</code>’s <code class="highlighter-rouge">src/test/scala</code> directory
that encodes scores in trees.</p>

<h3 id="creating-an-avroscoreauditor">Creating an AvroScoreAuditor</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.eharmony.aloha.audit.impl.avro.AvroScoreAuditor</span>

<span class="c1">// Specify the type parameter.  Could be something else beside Double
</span><span class="k">val</span> <span class="n">optAuditor</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">AvroScoreAuditor</span><span class="o">[</span><span class="kt">Double</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">AvroScoreAuditor</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
<span class="k">val</span> <span class="n">auditor</span> <span class="k">=</span> <span class="n">optAuditor</span><span class="o">.</span><span class="n">get</span>
</code></pre>
</div>

<h3 id="creating-a-protocol-buffer-scoreauditor">Creating a Protocol Buffer ScoreAuditor</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.eharmony.aloha.audit.impl.proto.ScoreAuditor</span>

<span class="c1">// Specify the type parameter.  Could be something else beside Double
</span><span class="k">val</span> <span class="n">optAuditor</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">ScoreAuditor</span><span class="o">[</span><span class="kt">Double</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">ScoreAuditor</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
<span class="k">val</span> <span class="n">auditor</span> <span class="k">=</span> <span class="n">optAuditor</span><span class="o">.</span><span class="n">get</span>
</code></pre>
</div>

<h3 id="creating-an-optionauditor">Creating an OptionAuditor</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.eharmony.aloha.audit.impl.OptionAuditor</span>

<span class="c1">// Specify the type parameter.  Could be something else beside Float
</span><span class="k">val</span> <span class="n">auditor</span> <span class="k">=</span> <span class="nc">OptionAuditor</span><span class="o">[</span><span class="kt">Double</span><span class="o">]()</span>
</code></pre>
</div>

<h2 id="modelfactory">ModelFactory</h2>

<p>Model factories are provide the mechanism to parse an external JSON model definition.  To create, we need a
semantics and auditor as explained above.  Once we have these, we can create model factory very easily.
<code class="highlighter-rouge">ModelFactory.defaultFactory</code> finds all model definitions on the class path (via class path scanning)
and allows these types of models to be parsed.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.eharmony.aloha.factory.ModelFactory</span>

<span class="k">val</span> <span class="n">modelFactory</span> <span class="k">=</span> <span class="nc">ModelFactory</span><span class="o">.</span><span class="n">defaultFactory</span><span class="o">(</span><span class="n">semantics</span><span class="o">,</span> <span class="n">auditor</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="models">Models</h2>

<p>Models are the components that make predictions.  They are easy to create, given a model factory:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.eharmony.aloha.audit.impl.OptionAuditor</span>
<span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.CompiledSemantics</span>
<span class="k">import</span> <span class="nn">concurrent.ExecutionContext.Implicits.global</span>
<span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.plugin.csv.CompiledSemanticsCsvPlugin</span>
<span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.plugin.csv.CsvTypes.IntType</span>
<span class="k">import</span> <span class="nn">com.eharmony.aloha.semantics.compiled.plugin.csv.CsvLines</span>

<span class="k">val</span> <span class="n">modelFile</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">java.io.File</span>
  <span class="k">val</span> <span class="n">alohaRoot</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"."</span><span class="o">).</span><span class="n">getAbsolutePath</span><span class="o">.</span><span class="n">replaceFirst</span><span class="o">(</span><span class="s">"/aloha/.*$"</span><span class="o">,</span> <span class="s">"/aloha/"</span><span class="o">))</span>
  <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">alohaRoot</span><span class="o">,</span> <span class="s">"aloha-core/src/test/resources/fizzbuzz.json"</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">compiler</span> <span class="k">=</span> <span class="nc">TwitterEvalCompiler</span><span class="o">(</span><span class="n">classCacheDir</span> <span class="k">=</span> <span class="n">cacheDir</span><span class="o">)</span>
<span class="k">val</span> <span class="n">imports</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"com.eharmony.aloha.feature.BasicFunctions._"</span><span class="o">,</span> <span class="s">"scala.math._"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">plugin</span> <span class="k">=</span> <span class="nc">CompiledSemanticsCsvPlugin</span><span class="o">(</span><span class="s">"profile.user_id"</span> <span class="o">-&gt;</span> <span class="nc">IntType</span><span class="o">)</span>
<span class="k">val</span> <span class="n">semantics</span> <span class="k">=</span> <span class="nc">CompiledSemantics</span><span class="o">(</span><span class="n">compiler</span><span class="o">,</span> <span class="n">plugin</span><span class="o">,</span> <span class="n">imports</span><span class="o">)</span>
<span class="k">val</span> <span class="n">auditor</span> <span class="k">=</span> <span class="nc">OptionAuditor</span><span class="o">[</span><span class="kt">Double</span><span class="o">]()</span>
<span class="k">val</span> <span class="n">modelFactory</span> <span class="k">=</span> <span class="nc">ModelFactory</span><span class="o">.</span><span class="n">defaultFactory</span><span class="o">(</span><span class="n">semantics</span><span class="o">,</span> <span class="n">auditor</span><span class="o">)</span>
</code></pre>
</div>

<h3 id="get-model-from-modelfactory">Get Model from ModelFactory</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="c1">// There are many other methods that retrieve models from InputStreams, Apache VFS, etc.
</span>     <span class="o">|</span> <span class="k">val</span> <span class="n">modelTry</span> <span class="k">=</span> <span class="n">modelFactory</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="n">modelFile</span><span class="o">)</span>  <span class="c1">// wrapped in a scala.util.Try
</span><span class="n">modelTry</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">com.eharmony.aloha.models.Model</span><span class="o">[</span><span class="kt">com.eharmony.aloha.semantics.compiled.plugin.csv.CsvLine</span>,<span class="kt">Option</span><span class="o">[</span><span class="kt">Double</span><span class="o">]]]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(&lt;</span><span class="n">function1</span><span class="o">&gt;)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">modelTry</span><span class="o">.</span><span class="n">get</span>
<span class="n">model</span><span class="k">:</span> <span class="kt">com.eharmony.aloha.models.Model</span><span class="o">[</span><span class="kt">com.eharmony.aloha.semantics.compiled.plugin.csv.CsvLine</span>,<span class="kt">Option</span><span class="o">[</span><span class="kt">Double</span><span class="o">]]</span> <span class="k">=</span> <span class="o">&lt;</span><span class="n">function1</span><span class="o">&gt;</span>
</code></pre>
</div>

<h3 id="predict-with-model">Predict with Model</h3>

<p>Models extend Scala’s <code class="highlighter-rouge">Function1</code> trait so they have an <code class="highlighter-rouge">apply</code> method.  Since <code class="highlighter-rouge">.apply</code> can
be dropped in Scala code, we can call the predict function very easily:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="nc">Seq</span><span class="o">(</span><span class="n">x1</span><span class="o">,</span> <span class="n">x2</span><span class="o">)</span> <span class="k">=</span> <span class="nc">CsvLines</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="s">"profile.user_id"</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">))(</span><span class="nc">Seq</span><span class="o">(</span><span class="s">"1"</span><span class="o">,</span> <span class="s">"2"</span><span class="o">))</span>
</code></pre>
</div>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">y1</span> <span class="k">=</span> <span class="n">model</span><span class="o">(</span><span class="n">x1</span><span class="o">)</span>
<span class="n">y1</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mf">1.0</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">y2</span> <span class="k">=</span> <span class="n">model</span><span class="o">(</span><span class="n">x2</span><span class="o">)</span>
<span class="n">y2</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mf">2.0</span><span class="o">)</span>
</code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/aloha/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/aloha/js/main.js"></script><script src="/aloha/js/kazari.js"></script><script>
$(document).ready(function() {
	kazari.KazariPlugin().decorateCode('https://scala-evaluator-212.herokuapp.com/eval', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.S2F6YXJp.Jl2eqMfw8IakJF93PjxTbrf-8YUJgX5OoOfy5JHE8Yw', '', 'solarized-dark')
})
    </script></body></html>
